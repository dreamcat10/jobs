{"remainingRequest":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\H5\\project\\HBuilderProjects\\jobs\\src\\components\\content\\news\\ChatRoom.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\src\\components\\content\\news\\ChatRoom.vue","mtime":1678102071236},{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\css-loader\\index.js","mtime":1673771963705},{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1673772000062},{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\postcss-loader\\src\\index.js","mtime":1673772003590},{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1673771979702},{"path":"D:\\H5\\project\\HBuilderProjects\\jobs\\node_modules\\vue-loader\\lib\\index.js","mtime":1673772000036}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t .text-btu{\n\t\tposition: absolute;\n\t\tbottom: 5px;\n\t\tright: 100px;\n\t}\n\t  textarea {\n\t    box-sizing: border-box;\n\t    padding: 10px 30px 0 30px ;\n\t    height: 110px;\n\t    width: 100%;\n\t    border: none;\n\t    outline: none;\n\t    font-family: 'Micrsofot Yahei';\n\t    resize: none;\n\t\tvertical-align: top; \n\t\tbackground-color: #F9FAFD;\n\t  }\n\n\t.chat-room{\n\t\theight: 100%;\n\t}\n\t.chat-list{\n\t\tbox-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1)\n\t}\n\t.ul-scroll{\n\t\tlist-style: none;\n\t\tmargin: 0px;\n\t\tpadding: 0;\n\t\toverflow: auto;\n\t\tdisplay: inline-block;\n\t\twhite-space: nowrap;\n\t\theight: 100%; \n\t\twidth: 100%;\n\t\tbackground: #F9FAFD;\n\t\tborder-radius: 5px;\n\t}\n\t.ul-scroll-item{\n\t\twidth: 100%;\n\t}\n\t.log-item-left{\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t}\n\t.log-item-right{\n\t\tdisplay: flex;\n\t\twidth: 100%;\n\t}\n\t.log-detail-left {\n\t\tbackground-color: #e5e5e5;\n\t\tborder-radius: 4px;\n\t\tposition: relative;\n\t\tmargin-top: 54px;\n\t\tmargin-left: 10px;\n\t\tpadding: 10px;\n\t\ttext-align: left;\n\t}\n\t.log-detail-left::after{\n\t\tcontent: '';\n\t\tborder-top: 30px solid #e5e5e5;\n\t\tborder-right: 15px solid transparent;\n\t\ttransform: rotate(113deg);\n\t\tposition: absolute;\n\t\ttop: 0px;\n\t\tleft: -16px;\n\t}\n\t.log-detail-right {\n\t\tbackground-color: #12b7f5;\n\t\tborder-radius: 4px;\n\t\tposition: relative;\n\t\tmargin-top: 54px;\n\t\tmargin-left: 10px;\n\t\tpadding: 10px;\n\t\tcolor: #FFF;\n\t\ttext-align: left;\n\t}\n\t.log-detail-right::after{\n\t\tcontent: '';\n\t\tborder-top: 30px solid #12b7f5;\n\t\tborder-right: 15px solid transparent;\n\t\ttransform: rotate(216deg);\n\t\tposition: absolute;\n\t\ttop: 0px;\n\t\tright: -10px;\n\t}\n\t.chat-list{\n\t\theight: 80%;\n\t\toverflow: hidden;\n\t\tline-height: 20px;\n\t\ttext-align: center;\n\t}\n\t.chat-text{\n\t\theight: 20%;\n\t\tbackground-color: #F9FAFD;\n\t\tborder-top: 1px solid #dedede;\n\t\tposition: relative;\n\t}\n  .ul-scroll::-webkit-scrollbar {\n\twidth: 10px;\n\tbackground-color: #f9fafd;\n  }\n  .ul-scroll::-webkit-scrollbar-thumb {\n\tborder-radius: 5px;\n\tbackground-color: #e9eef3;\n  }\n/* .ul-scroll::-webkit-scrollbar-button {\n\twidth: 10px;\n\tbackground-color: #d3dce6;\n\t\n  } */\n  .ul-scroll::-webkit-scrollbar-track {\n\tborder-radius: 5px;\n  }\n\n",{"version":3,"sources":["ChatRoom.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"ChatRoom.vue","sourceRoot":"src/components/content/news","sourcesContent":["<template>\r\n\t<div class=\"chat-room\">\r\n\t\t<div class=\"chat-list\" >\r\n\t\t\t<ul class=\"ul-scroll\" ref=\"chatLogList\" @scroll=\"scrollEvent\">\r\n\t\t\t\t<li v-show=\"page <= MaxPage\" style=\"height: 80px;\">\r\n\t\t\t\t\t<el-button type=\"text\" icon=\"el-icon-time\" :loading=\"isLoading\" @click=\"getHistory()\">点击查看更多消息</el-button>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li v-show=\"isShow\" style=\"height: 80px;\">\r\n\t\t\t\t\t<el-button type=\"text\" @click=\"scrollToBottom()\">点击返回底部</el-button>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li class=\"ul-scroll-item\" v-for=\"item in concatList\">\r\n\t\t\t\t\t<div class=\"log-item-left\" v-if=\"item.fromId == room.otherId\">\r\n\t\t\t\t\t\t<el-avatar :size=\"50\" :src=\"room.oAvatar\"></el-avatar>\r\n\t\t\t\t\t\t<div class=\"log-detail-left\" v-html=\"item.context.replace(/\\\\n/g, '<br/>')\">\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"log-item-right\" v-else =\"item.fromId != room.otherId\">\r\n\t\t\t\t\t\t<div style=\"display: flex; margin-left: auto;\">\r\n\t\t\t\t\t\t\t<div class=\"log-detail-right\">\r\n\t\t\t\t\t\t\t\t<span v-html=\"item.context.replace(/\\\\n/g, '<br/>')\"></span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<el-avatar :size=\"50\" :src=\"empInfo.avatar\"></el-avatar>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</li>\r\n\t\t\t\t<li style=\"height: 20px;\"></li>\r\n\t\t\t</ul>\r\n\t\t\t<el-backtop target=\"ul.ul-scroll\" :bottom=\"162\" :right=\"165\" style=\"width: 20px; height: 20px;\"></el-backtop>\r\n\t\t</div>\r\n\t\t<div class=\"chat-text\">\r\n\t\t\t<textarea @keyup.enter=\"send(context)\" v-model=\"context\"></textarea>\r\n\t\t\t<el-button type=\"primary\" class=\"text-btu\" @click=\"send(context)\">发送</el-button>\r\n\t\t</div>\r\n\t</div>\n</template>\n\n<script>\r\n\timport { mapGetters, mapState, mapActions } from 'vuex'\r\n\timport {chatLogs} from'@/network/chat.js'\r\n\timport {sendSock} from '@/api/websocket.js'\r\n\t\r\n\texport default{\r\n\t\tname:'ChatRoom',\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\tcontext: '',\r\n\t\t\t\tpage: 1,\r\n\t\t\t\ttotal: 1,\r\n\t\t\t\tsize: 1,\r\n\t\t\t\tdbLogs: [], //离线前接收的消息\r\n\t\t\t\tlist: [],\r\n\t\t\t\tisLoading: false,\r\n\t\t\t\tscrollFlag: true,\r\n\t\t\t\tlastScrollHeight: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tprops:{\r\n\t\t\troom: {\r\n\t\t\t\ttype: Object\r\n\t\t\t},\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t...mapState(['chatLogs','empInfo']),\t\t\r\n\t\t\tlogList(){ //离线后接收的消息\r\n\t\t\t\tlet logs = []\r\n\t\t\t\tif(this.chatLogs != null){\r\n\t\t\t\t\tthis.chatLogs.forEach(item =>{\r\n\t\t\t\t\t\tif(item.roomId == this.room.id){\r\n\t\t\t\t\t\t\tlogs = item.logs;\r\n\t\t\t\t\t\t\tthis.removeLog()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.scrollFlag = true\r\n\t\t\t\t}\r\n\t\t\t\treturn logs\r\n\t\t\t},\r\n\t\t\tMaxPage(){\r\n\t\t\t\treturn Math.ceil(this.total / this.size); \r\n\t\t\t},\r\n\t\t\tisShow(){\r\n\t\t\t\treturn this.page >this.MaxPage && this.$refs.chatLogList.scrollHeight > 600\r\n\t\t\t},\r\n\t\t\tconcatList: {\r\n\t\t\t\tget(){\t\t\t\t\t\r\n\t\t\t\t\tlet logs = this.list\r\n\t\t\t\t\tthis.dbLogs.forEach(item => {\r\n\t\t\t\t\t\tlogs.unshift(item)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.dbLogs = []\r\n\t\t\t\t\tlogs = logs.concat(this.logList)\r\n\t\t\t\t\tthis.list = logs\r\n\t\t\t\t\treturn logs\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\r\n\t\t},\r\n\t\twatch:{\t\r\n\t\t\troom(val){\r\n\t\t\t\tthis.getChatLogs()\t\t\t\t\r\n\t\t\t},\r\n\t\t},\r\n\t\tactivated() {\r\n\t\t\tthis.$refs.chatLogList.scrollTop = this.$refs.chatLogList.scrollHeight \r\n\t\t},\r\n\t\tmounted() {\t\t\r\n\t\t\tif(this.room.id != null){\r\n\t\t\t\tthis.getChatLogs()\r\n\t\t\t}\r\n\t\t\tif(this.scrollFlag){\r\n\t\t\t\tconsole.log('bottom')\r\n\t\t\t\tthis.$refs.chatLogList.scrollTop = this.$refs.chatLogList.scrollHeight\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdated() {\r\n\t\t\tif(this.scrollFlag){\r\n\t\t\t\tthis.scrollToBottom()\r\n\t\t\t}else{\r\n\t\t\t\tthis.scrollUnchange()\r\n\t\t\t}\t\t\r\n\t\t},\r\n\t\t\r\n\t\tmethods:{\r\n\t\t\t//发送消息\r\n\t\t\tsend(val){\r\n\t\t\t\tthis.context = ''\r\n\t\t\t\tlet context = JSON.stringify(val)\r\n\t\t\t\tlet msg = '{\"toId\":\"'+ this.room.otherId +'\",\"contentText\":'+ context +',\"roomId\":\"'+ this.room.id +'\"}'\r\n\t\t\t\tsendSock(msg)\r\n\t\t\t\tconsole.log(msg)\r\n\t\t\t},\r\n\t\t\tscrollEvent(e){\r\n\t\t\t\tif(e.srcElement.scrollTop == 0 && this.page <= this.MaxPage){\r\n\t\t\t\t\tthis.lastScrollHeight = e.srcElement.scrollHeight\r\n\t\t\t\t\tsetTimeout(() =>{\r\n\t\t\t\t\t\tthis.getHistory()\r\n\t\t\t\t\t},500)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tremoveLog(){\r\n\t\t\t\tthis.$store.commit('REMOVE_LOGS',this.room.id)\r\n\t\t\t},\r\n\t\t\t//滚动条保持最底部方法\r\n\t\t\tscrollToBottom () {\r\n\t\t\t  this.$nextTick(() => {\r\n\t\t\t\t  //回到底部需要滚动的长度\r\n\t\t\t\t\tlet top = this.$refs.chatLogList.scrollHeight - this.$refs.chatLogList.scrollTop\r\n\t\t\t  \r\n\t\t\t\t\t// 实现滚动效果 \t\t\t  \r\n\t\t\t\t\tconst timeTop = setInterval(() => {\t\t\t  \r\n\t\t\t\t\t  this.$refs.chatLogList.scrollTop += 80;  \r\n\t\t\t\t\t  top -= 50;\r\n\t\t\t\t\t  if (top <= 0) {\t\t  \r\n\t\t\t\t\t\tclearInterval(timeTop); //清除定时器\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t}, 10);\r\n\t\t\t  })\r\n\t\t\t},\r\n\t\t\t//页面保持原位置\r\n\t\t\tscrollUnchange () {\r\n\t\t\t  this.$nextTick(() => {\r\n\t\t\t\t  this.$refs.chatLogList.scrollTop = this.$refs.chatLogList.scrollHeight - this.lastScrollHeight + 80\r\n\t\t\t  })\r\n\t\t\t},\r\n\t\t\tgetHistory(){\r\n\t\t\t\tthis.isLoading = true\r\n\t\t\t\tthis.scrollFlag = false\r\n\t\t\t\tthis.getChatLogs()\r\n\t\t\t},\r\n\t\t\tgetChatLogs(){\r\n\t\t\t\tchatLogs(this.room.id, this.page).then(res => {\r\n\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\tlet data = res.data\r\n\t\t\t\t\tif(data.code == 200){\r\n\t\t\t\t\t\tthis.dbLogs = data.data.recodes\r\n\t\t\t\t\t\tthis.total = data.data.total\r\n\t\t\t\t\t\tthis.size = data.data.size\r\n\t\t\t\t\t\tthis.page += 1\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis.isLoading = false\r\n\t\t\t\t\t\t},500)\r\n\t\t\t\t\t\tconsole.log('page,max',this.page,this.MaxPage)\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tthis.$message({\r\n\t\t\t\t\t  type: 'error',\r\n\t\t\t\t\t  message: '网络异常，请稍后重试！！！'\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t}\r\n\t}\n</script>\n\n<style>\r\n\t .text-btu{\r\n\t\tposition: absolute;\r\n\t\tbottom: 5px;\r\n\t\tright: 100px;\r\n\t}\r\n\t  textarea {\r\n\t    box-sizing: border-box;\r\n\t    padding: 10px 30px 0 30px ;\r\n\t    height: 110px;\r\n\t    width: 100%;\r\n\t    border: none;\r\n\t    outline: none;\r\n\t    font-family: 'Micrsofot Yahei';\r\n\t    resize: none;\r\n\t\tvertical-align: top; \r\n\t\tbackground-color: #F9FAFD;\r\n\t  }\r\n\r\n\t.chat-room{\r\n\t\theight: 100%;\r\n\t}\r\n\t.chat-list{\r\n\t\tbox-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1)\r\n\t}\r\n\t.ul-scroll{\r\n\t\tlist-style: none;\r\n\t\tmargin: 0px;\r\n\t\tpadding: 0;\r\n\t\toverflow: auto;\r\n\t\tdisplay: inline-block;\r\n\t\twhite-space: nowrap;\r\n\t\theight: 100%; \r\n\t\twidth: 100%;\r\n\t\tbackground: #F9FAFD;\r\n\t\tborder-radius: 5px;\r\n\t}\r\n\t.ul-scroll-item{\r\n\t\twidth: 100%;\r\n\t}\r\n\t.log-item-left{\r\n\t\tdisplay: flex;\r\n\t\twidth: 100%;\r\n\t}\r\n\t.log-item-right{\r\n\t\tdisplay: flex;\r\n\t\twidth: 100%;\r\n\t}\r\n\t.log-detail-left {\r\n\t\tbackground-color: #e5e5e5;\r\n\t\tborder-radius: 4px;\r\n\t\tposition: relative;\r\n\t\tmargin-top: 54px;\r\n\t\tmargin-left: 10px;\r\n\t\tpadding: 10px;\r\n\t\ttext-align: left;\r\n\t}\r\n\t.log-detail-left::after{\r\n\t\tcontent: '';\r\n\t\tborder-top: 30px solid #e5e5e5;\r\n\t\tborder-right: 15px solid transparent;\r\n\t\ttransform: rotate(113deg);\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t\tleft: -16px;\r\n\t}\r\n\t.log-detail-right {\r\n\t\tbackground-color: #12b7f5;\r\n\t\tborder-radius: 4px;\r\n\t\tposition: relative;\r\n\t\tmargin-top: 54px;\r\n\t\tmargin-left: 10px;\r\n\t\tpadding: 10px;\r\n\t\tcolor: #FFF;\r\n\t\ttext-align: left;\r\n\t}\r\n\t.log-detail-right::after{\r\n\t\tcontent: '';\r\n\t\tborder-top: 30px solid #12b7f5;\r\n\t\tborder-right: 15px solid transparent;\r\n\t\ttransform: rotate(216deg);\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t\tright: -10px;\r\n\t}\r\n\t.chat-list{\r\n\t\theight: 80%;\r\n\t\toverflow: hidden;\r\n\t\tline-height: 20px;\r\n\t\ttext-align: center;\r\n\t}\r\n\t.chat-text{\r\n\t\theight: 20%;\r\n\t\tbackground-color: #F9FAFD;\r\n\t\tborder-top: 1px solid #dedede;\r\n\t\tposition: relative;\r\n\t}\r\n  .ul-scroll::-webkit-scrollbar {\r\n\twidth: 10px;\r\n\tbackground-color: #f9fafd;\r\n  }\r\n  .ul-scroll::-webkit-scrollbar-thumb {\r\n\tborder-radius: 5px;\r\n\tbackground-color: #e9eef3;\r\n  }\r\n/* .ul-scroll::-webkit-scrollbar-button {\r\n\twidth: 10px;\r\n\tbackground-color: #d3dce6;\r\n\t\r\n  } */\r\n  .ul-scroll::-webkit-scrollbar-track {\r\n\tborder-radius: 5px;\r\n  }\r\n\n</style>\n"]}]}